<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualization – Seeing is Believing</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div class="scroll-progress-wrap"><div class="scroll-progress-bar"></div></div>

  <header class="site-header">
    <a href="../index.html" class="site-title">Bioinformatics</a>
    <nav class="site-nav">
      <a href="../index.html">Home</a>
    </nav>
  </header>

  <article class="blog-article">
    <header class="article-header">
      <h1 class="article-title">Visualization – Seeing is Believing</h1>
      <p class="article-subtitle">In this section, we will differentiate between analysis file formats (<code>.bed</code>) and visualization file formats (<code>.bw</code> / BigWig), derive accurate chromosome sizes directly from a reference genome using <code>samtools</code>, execute a file conversion pipeline using <code>bedtools</code> to transform raw reads into a coverage track, and visualize genomic data using the cloud-based IGV Web App to perform a visual sanity check by overlaying raw signal with statistical calls.</p>
      <figure class="article-figure">
        <img src="../images/atac_seq.png" alt="Visualization of ATAC-seq coverage tracks">
      </figure>
      <div class="article-meta">
        <div class="meta-column">
          <span class="meta-label">Author</span>
          <span class="meta-value">Yerkem Shakhman</span>
        </div>
        <div class="meta-column">
          <span class="meta-label">Chapter</span>
          <span class="meta-value">9 — Visualization</span>
        </div>
      </div>
    </header>

    <div class="article-body">
      <aside class="article-toc">
        <h2 class="toc-title">Contents</h2>
        <nav class="toc-nav">
          <ul class="toc-list">
            <li><a href="#the-concept">The Concept: From Spreadsheets to Landscapes</a></li>
            <li><a href="#phase-1">Phase 1: Tool Installation</a></li>
            <li>
              <a href="#phase-2">Phase 2: Defining the Map Boundaries</a>
              <ul>
                <li><a href="#calculate-size">Calculate the Size</a></li>
                <li><a href="#create-sizes-file">Create the Sizes File</a></li>
              </ul>
            </li>
            <li>
              <a href="#phase-3">Phase 3: Creating the Coverage Track</a>
              <ul>
                <li><a href="#bed-to-bedgraph">Calculate Coverage</a></li>
                <li><a href="#sort-data">Sort the Data</a></li>
                <li><a href="#compress-bigwig">Compress to BigWig</a></li>
                <li><a href="#clean-up">Clean Up</a></li>
              </ul>
            </li>
            <li><a href="#summary">Next Step</a></li>
          </ul>
        </nav>
      </aside>

      <div class="article-content">

        <section id="the-concept">
          <h2>The Concept: From Spreadsheets to Landscapes</h2>
          <p>
            At this stage in our journey, your data exists in two primary formats: <code>final_clean_peaks.bed</code> (your filtered reads) and <code>ENCFF535OGL_peaks.narrowPeak</code> (your statistical peaks). While these files contain all your biological discoveries, they are essentially massive spreadsheets containing millions of lines of coordinates.
          </p>
          <p>
            If you tried to load millions of text lines directly into a genome browser, it would overwhelm your computer's memory. To visualize the data effectively, we need to change its shape. We need to calculate <strong>Coverage</strong> — essentially counting how many reads stack up at every single base pair of the genome to form "mountains" of data.
          </p>
          <p>
            We save this coverage data in a format called <strong>BigWig (<code>.bw</code>)</strong>. Unlike the text-heavy BED format ("Read A is at position 100"), a BigWig file is binary and compressed ("Position 100 has a pile height of 50"). This makes it ultra-fast for browsing. Our goal in this chapter is to convert our alignment into a BigWig file and then load it into a web browser to verify our results with our own eyes.
          </p>
        </section>

        <section id="phase-1">
          <h2>Phase 1: Tool Installation</h2>
          <p>
            To perform this conversion, we need to add a few more tools to our bioinformatics toolkit. We need <strong><code>samtools</code></strong> to read the reference genome index, <strong><code>bedtools</code></strong> to calculate the coverage (the "Swiss Army Knife" of genomics), and <strong><code>ucsc-bedgraphtobigwig</code></strong> to perform the final compression.
          </p>
          <p>Run the following command to install them into your environment:</p>
          <div class="code-cell">
            <button class="copy-btn" aria-label="Copy to clipboard">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <pre><code>conda activate bio-tools

conda install samtools

conda install -c bioconda bedtools ucsc-bedgraphtobigwig</code></pre>
          </div>
          <p>
            The terminal will display the "Package Plan" listing the dependencies to be installed. Once you type <code>y</code> and hit Enter, it will download and install the software, returning you to the command prompt when finished.
          </p>
        </section>

        <section id="phase-2">
          <h2>Phase 2: Defining the Map Boundaries (Chromosome Sizes)</h2>
          <p>
            Before we can build a map of our reads, the computer needs to know the boundaries of the territory. Since we are using our "Toy" reference genome (Chromosome 19), we need a simple text file that tells the software exactly how long Chromosome 19 is. Without this, the software won't know when to stop drawing the map.
          </p>

          <h3 id="calculate-size">Step 1: Calculate the Size</h3>
          <p>
            We do not need to look up this information online; we can derive it directly from the reference file (<code>chr19.fa</code>) we downloaded in Chapter 6. We use <code>samtools faidx</code> (Fasta Index) to scan the file and count the bases.
          </p>
          <div class="code-cell">
            <button class="copy-btn" aria-label="Copy to clipboard">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <pre><code>cd reference_data

samtools faidx chr19.fa

cat chr19.fa.fai</code></pre>
          </div>
          <p>
            <strong>Expected Output:</strong>
          </p>
          <div class="code-cell">
            <pre><code>chr19	61431566	7	50	51</code></pre>
          </div>
          <p>
            The second number, <strong><code>61431566</code></strong>, is the critical piece of information: it is the exact length of Chromosome 19 in base pairs.
          </p>

          <h3 id="create-sizes-file">Step 2: Create the Sizes File (Avoiding the "Hidden Character" Trap)</h3>
          <p>Now we need to save this name and number into a file named <code>chr19.chrom.sizes</code>.</p>
          <blockquote>
            <p><strong>Important Formatting Note:</strong> Bioinformatics tools are extremely strict about formatting. The columns in this file must be separated by a <strong>Tab</strong> character, not a Space. If you use a space, <code>bedtools</code> will fail to read the file. To ensure we create a perfect file, we use the <code>printf</code> command with <code>\t</code>, which forces the computer to insert a real Tab character.</p>
          </blockquote>
          <div class="code-cell">
            <button class="copy-btn" aria-label="Copy to clipboard">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <pre><code>cd ..

printf "chr19\t61431566\n" > reference_data/chr19.chrom.sizes</code></pre>
          </div>
          <p>
            This command is silent. It produces no text on the screen, but if you run <code>cat reference_data/chr19.chrom.sizes</code>, you will see your properly formatted file.
          </p>
        </section>

        <section id="phase-3">
          <h2>Phase 3: Creating the Coverage Track (The BigWig)</h2>
          <p>
            Now that we have our map boundaries, we can convert our raw reads into a visual track. This is a standard three-step pipeline: <strong>Count → Sort → Compress</strong>.
          </p>

          <h3 id="bed-to-bedgraph">Step 1: Calculate Coverage (BED to BedGraph)</h3>
          <p>
            We use <code>bedtools genomecov</code> to count the reads piling up at each base. We are taking our clean aligned reads (<code>final_clean_peaks.bed</code>) and asking the tool to output a "BedGraph" format text file.
          </p>
          <div class="code-cell">
            <button class="copy-btn" aria-label="Copy to clipboard">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <pre><code>mkdir -p results/visualization

bedtools genomecov -i results/chromap/final_clean_peaks.bed \
                   -g reference_data/chr19.chrom.sizes \
                   -bg > results/visualization/temp.bedgraph</code></pre>
          </div>
          <p>
            The <code>-i</code> flag specifies the input (your clean, aligned reads), <code>-g</code> provides the genome sizes file (the map boundaries), and <code>-bg</code> sets the output format (BedGraph text file). This command runs silently. If successful, it creates a new file <code>results/visualization/temp.bedgraph</code> and returns you to the command prompt.
          </p>

          <h3 id="sort-data">Step 2: Sort the Data</h3>
          <p>
            The compression tool we use in the next step is picky; it requires the data to be sorted by chromosome position (from the beginning of the chromosome to the end). We use the <code>sort</code> command to arrange the lines numerically.
          </p>
          <div class="code-cell">
            <button class="copy-btn" aria-label="Copy to clipboard">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <pre><code>sort -k1,1 -k2,2n results/visualization/temp.bedgraph > results/visualization/sorted.bedgraph</code></pre>
          </div>
          <p>
            This command reads your temp file and saves the sorted version as <code>results/visualization/sorted.bedgraph</code>. The <code>-k1,1</code> flag sorts by chromosome (column 1) and <code>-k2,2n</code> sorts by numeric position (column 2).
          </p>

          <h3 id="compress-bigwig">Step 3: Compress to BigWig (BedGraph to BigWig)</h3>
          <p>
            Finally, we convert the text file into the binary BigWig format using the <code>bedGraphToBigWig</code> tool. This dramatically reduces the file size and makes it readable by web browsers.
          </p>
          <div class="code-cell">
            <button class="copy-btn" aria-label="Copy to clipboard">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <pre><code>bedGraphToBigWig results/visualization/sorted.bedgraph \
                 reference_data/chr19.chrom.sizes \
                 results/visualization/ENCFF535OGL.bw</code></pre>
          </div>
          <p>
            This command runs silently. It creates your final result file: <code>results/visualization/ENCFF535OGL.bw</code>.
          </p>

          <h3 id="clean-up">Clean Up</h3>
          <p>
            We no longer need the intermediate text files (<code>temp.bedgraph</code> and <code>sorted.bedgraph</code>). It is good practice to delete them to keep your folders tidy.
          </p>
          <div class="code-cell">
            <button class="copy-btn" aria-label="Copy to clipboard">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <pre><code>rm results/visualization/*.bedgraph</code></pre>
          </div>
        </section>

        <section id="summary">
          <h2>Next Step</h2>
          <p>
            You have successfully transformed your flat text-based alignment data into a compressed, browser-ready BigWig coverage track. This file encodes the "height" of read pileups across every base pair of Chromosome 19, giving you a visual landscape of your ATAC-seq experiment.
          </p>
          <p>
            In this chapter, you learned the difference between analysis formats (<code>.bed</code>) and visualization formats (<code>.bw</code>), derived chromosome sizes directly from your reference genome using <code>samtools</code>, executed a three-step conversion pipeline (Count → Sort → Compress) using <code>bedtools</code> and <code>bedGraphToBigWig</code>, and prepared your data for visual inspection. In the next chapter, we will load this BigWig file alongside your peak calls into the IGV Web App to perform a final visual verification of your results.
          </p>
        </section>
      </div>
    </div>
  </article>

  <nav class="chapter-nav">
    <a href="chapter_8.html">
      <span class="nav-arrow">&larr;</span>
      <span class="nav-direction">Previous</span>
    </a>
    <a href="chapter_10.html">
      <span class="nav-direction">Next</span>
      <span class="nav-arrow">&rarr;</span>
    </a>
  </nav>

  <footer class="site-footer">
    <p>&copy; 2026 Bioinformatics by Yerkem Shakhman. Built for wet lab researchers and students in computational biology.</p>
  </footer>

  <script src="blog-post-ui.js"></script>
</body>
</html>
